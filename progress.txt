2026-01-29 - CH-1: Auto-save conversation after each exchange

COMPLETED:
- Modified Dialog.tsx to persist conversations to chrome.storage.local
- Conversations auto-save after each assistant response (streamEnd event)
- Auto-generates conversation title from first user message (truncated to 50 chars)
- Generates UUID for new conversations using crypto.randomUUID()
- Burn button (ðŸ”¥) now deletes conversation from storage (not just clears state)
- Conversation ID resets when provider changes or conversation cleared

FILES CHANGED:
- src/content/components/Dialog.tsx

NOTES FOR NEXT PERSON:
- CH-1 implemented (auto-save works), but history PANEL UI (CH-2) not yet built
- Conversations save to storage but no way to VIEW history list yet
- CH-7 (burn button) is functionally complete but can't be verified without history panel
- Storage infrastructure already exists for conversations (Storage.getConversations, etc)
- Next priority: CH-2 (history panel accessible from dialog header) to make saved convos visible

---

2026-01-29 - CH-2: History panel accessible from dialog header

COMPLETED:
- Created HistoryPanel.tsx component with slide-in panel UI
- Added ðŸ“œ history button to Dialog header
- Panel shows conversation list with title, date, message count
- Click conversation to load it into dialog (CH-3)
- Delete button on each conversation (CH-4)
- Empty state with localized message (UI-3)
- Forest theme styling matches dialog (UI-1)
- Added i18n translations for history section (all 10 languages)

FILES CHANGED:
- src/content/components/Dialog.tsx (import, state, handlers, JSX)
- src/content/components/HistoryPanel.tsx (new)
- src/shared/i18n/*.json (added history section)

PRD ITEMS COMPLETED:
- CH-2: History panel accessible from dialog header
- CH-3: Load previous conversation from history
- CH-4: Delete individual conversations from history
- CH-5: Auto-generate title (was in CH-1, now verifiable)
- CH-7: Burn button (was in CH-1, now verifiable)
- UI-1: History panel styling matches forest theme
- UI-3: Empty history state displayed correctly

NOTES FOR NEXT PERSON:
- CH-6 (retentionDays cleanup) not implemented - needs to be called somewhere on app init
- All persona features (P-1 through P-6) not started
- UI-2 (persona selector) not started
- DATA-1, DATA-2 (persona storage) not started
- INT-1, INT-2 (persona API integration) not started

---

2026-01-29 - P-1: Default personas available on first run

COMPLETED:
- Added Persona interface and DEFAULT_PERSONAS constant to types.ts
- 5 built-in personas: General, Code Helper, Writer, Researcher, Translator
- Each persona has: id, name, description, systemPrompt, icon, isBuiltIn
- Created PersonaSelector.tsx dropdown component in dialog header
- Persona selector shows icon + name, dropdown shows all personas with descriptions
- Persona's systemPrompt combined with user's custom systemPrompt in API calls
- Conversation stores personaId, restores when loading from history
- Added defaultPersonaId and customPersonas to Settings interface
- Added i18n translations for persona section (all 10 languages)

FILES CHANGED:
- src/shared/types.ts (Persona interface, DEFAULT_PERSONAS, Settings update)
- src/shared/storage.ts (getPersonas, getPersonaById methods)
- src/content/components/Dialog.tsx (import, state, PersonaSelector, system prompt logic)
- src/content/components/PersonaSelector.tsx (new)
- src/shared/i18n/*.json (added persona section)

PRD ITEMS COMPLETED:
- P-1: Default personas available on first run
- P-3: Persona selector in dialog allows switching
- P-4: Persona persists when loading conversation from history
- DATA-2: Conversation stores personaId
- INT-1: Persona system prompt included in API calls
- INT-2: User system prompt combines with persona prompt

NOTES FOR NEXT PERSON:
- P-2 (create custom persona in settings) not implemented - needs settings page UI
- P-5 (edit/delete custom personas) not implemented - needs settings page UI
- P-6 (set default persona for new conversations) - settings already has defaultPersonaId field, just needs UI
- DATA-1 (persona interface stored correctly) - only custom personas need storage, built-in are in code
- UI-2 (persona selector compact/unobtrusive) - implemented but may need styling review
- CH-6 (retentionDays cleanup) still not implemented

---

2026-01-29 - P-6: Set default persona for new conversations

COMPLETED:
- Added default persona dropdown to settings page (settings/index.html)
- Populated dropdown with built-in personas (icon + name)
- Settings.ts saves defaultPersonaId to storage on save
- Dialog.tsx already uses settings.defaultPersonaId for new conversations
- Added i18n translations for all 10 languages (defaultPersona, defaultPersonaHint)

FILES CHANGED:
- src/settings/index.html (added defaultPersona select element)
- src/settings/settings.ts (import DEFAULT_PERSONAS, populate/save defaultPersonaId)
- src/shared/i18n/*.json (added settings.defaultPersona, settings.defaultPersonaHint)

PRD ITEMS COMPLETED:
- P-6: Set default persona for new conversations

NOTES FOR NEXT PERSON:
- P-2 (create custom persona in settings) not implemented - needs settings page UI
- P-5 (edit/delete custom personas) not implemented - needs settings page UI
- DATA-1 (persona interface stored correctly) - only custom personas need storage
- UI-2 (persona selector compact/unobtrusive) - may need styling review
- CH-6 (retentionDays cleanup) still not implemented

---

2026-01-29 - P-2: Create custom persona in settings

COMPLETED:
- Added Personas section to settings page with "Add Persona" button
- Persona form with name, description, icon picker (12 icons), system prompt fields
- Icon picker with visual selection (click to select)
- Save/Cancel buttons for form
- Persona list shows built-in (green bg) and custom personas
- Edit/Delete buttons on custom personas
- Delete confirmation dialog
- Custom personas stored in settings.customPersonas array
- Custom personas automatically added to default persona dropdown
- Handles deletion of persona that's currently set as default
- Added i18n translations for all 10 languages

FILES CHANGED:
- src/settings/index.html (added styles, persona section HTML)
- src/settings/settings.ts (persona management logic)
- src/shared/i18n/*.json (added persona management translations)

PRD ITEMS COMPLETED:
- P-2: Create custom persona in settings
- P-5: Edit and delete custom personas in settings
- DATA-1: Persona interface stored correctly

NOTES FOR NEXT PERSON:
- UI-2 (persona selector compact/unobtrusive) - may need styling review
- CH-6 (retentionDays cleanup) still not implemented

---

2026-01-29 - CH-6: Respect retentionDays setting for cleanup

COMPLETED:
- Added call to Storage.clearOldConversations() when dialog opens
- Uses retentionDays from settings (default 30 days)
- Cleanup runs on every dialog open (filters by updatedAt timestamp)
- Storage.clearOldConversations() method already existed, just needed to be called

FILES CHANGED:
- src/content/components/Dialog.tsx (added cleanup call in useEffect)

PRD ITEMS COMPLETED:
- CH-6: Respect retentionDays setting for cleanup

NOTES FOR NEXT PERSON:
- UI-2 (persona selector compact/unobtrusive) is the only remaining non-passing item
- All chat-history features (CH-1 through CH-7) now pass
- All persona features (P-1 through P-6) pass
- All data/integration tests (DATA-1, DATA-2, INT-1, INT-2) pass

---

2026-01-29 - UI-2: Persona selector compact and unobtrusive

COMPLETED:
- Made trigger button more compact (smaller padding, transparent bg until hover)
- Reduced font sizes and spacing throughout selector
- Made name truncation tighter (80px max)
- Added visual grouping for custom personas (subtle background wrapper)
- Reduced dropdown dimensions for cleaner appearance
- All changes maintain forest theme consistency

FILES CHANGED:
- src/content/components/PersonaSelector.tsx (styling updates)
- plans/prd.json (marked UI-2 as passing)

PRD ITEMS COMPLETED:
- UI-2: Persona selector compact and unobtrusive

NOTES FOR NEXT PERSON:
- ALL PRD ITEMS NOW PASS
- All chat-history features (CH-1 through CH-7) pass
- All persona features (P-1 through P-6) pass
- All UI features (UI-1 through UI-3) pass
- All data/integration tests (DATA-1, DATA-2, INT-1, INT-2) pass
