2026-01-29 - CH-1: Auto-save conversation after each exchange

COMPLETED:
- Modified Dialog.tsx to persist conversations to chrome.storage.local
- Conversations auto-save after each assistant response (streamEnd event)
- Auto-generates conversation title from first user message (truncated to 50 chars)
- Generates UUID for new conversations using crypto.randomUUID()
- Burn button (ðŸ”¥) now deletes conversation from storage (not just clears state)
- Conversation ID resets when provider changes or conversation cleared

FILES CHANGED:
- src/content/components/Dialog.tsx

NOTES FOR NEXT PERSON:
- CH-1 implemented (auto-save works), but history PANEL UI (CH-2) not yet built
- Conversations save to storage but no way to VIEW history list yet
- CH-7 (burn button) is functionally complete but can't be verified without history panel
- Storage infrastructure already exists for conversations (Storage.getConversations, etc)
- Next priority: CH-2 (history panel accessible from dialog header) to make saved convos visible

---

2026-01-29 - CH-2: History panel accessible from dialog header

COMPLETED:
- Created HistoryPanel.tsx component with slide-in panel UI
- Added ðŸ“œ history button to Dialog header
- Panel shows conversation list with title, date, message count
- Click conversation to load it into dialog (CH-3)
- Delete button on each conversation (CH-4)
- Empty state with localized message (UI-3)
- Forest theme styling matches dialog (UI-1)
- Added i18n translations for history section (all 10 languages)

FILES CHANGED:
- src/content/components/Dialog.tsx (import, state, handlers, JSX)
- src/content/components/HistoryPanel.tsx (new)
- src/shared/i18n/*.json (added history section)

PRD ITEMS COMPLETED:
- CH-2: History panel accessible from dialog header
- CH-3: Load previous conversation from history
- CH-4: Delete individual conversations from history
- CH-5: Auto-generate title (was in CH-1, now verifiable)
- CH-7: Burn button (was in CH-1, now verifiable)
- UI-1: History panel styling matches forest theme
- UI-3: Empty history state displayed correctly

NOTES FOR NEXT PERSON:
- CH-6 (retentionDays cleanup) not implemented - needs to be called somewhere on app init
- All persona features (P-1 through P-6) not started
- UI-2 (persona selector) not started
- DATA-1, DATA-2 (persona storage) not started
- INT-1, INT-2 (persona API integration) not started

---

2026-01-29 - P-1: Default personas available on first run

COMPLETED:
- Added Persona interface and DEFAULT_PERSONAS constant to types.ts
- 5 built-in personas: General, Code Helper, Writer, Researcher, Translator
- Each persona has: id, name, description, systemPrompt, icon, isBuiltIn
- Created PersonaSelector.tsx dropdown component in dialog header
- Persona selector shows icon + name, dropdown shows all personas with descriptions
- Persona's systemPrompt combined with user's custom systemPrompt in API calls
- Conversation stores personaId, restores when loading from history
- Added defaultPersonaId and customPersonas to Settings interface
- Added i18n translations for persona section (all 10 languages)

FILES CHANGED:
- src/shared/types.ts (Persona interface, DEFAULT_PERSONAS, Settings update)
- src/shared/storage.ts (getPersonas, getPersonaById methods)
- src/content/components/Dialog.tsx (import, state, PersonaSelector, system prompt logic)
- src/content/components/PersonaSelector.tsx (new)
- src/shared/i18n/*.json (added persona section)

PRD ITEMS COMPLETED:
- P-1: Default personas available on first run
- P-3: Persona selector in dialog allows switching
- P-4: Persona persists when loading conversation from history
- DATA-2: Conversation stores personaId
- INT-1: Persona system prompt included in API calls
- INT-2: User system prompt combines with persona prompt

NOTES FOR NEXT PERSON:
- P-2 (create custom persona in settings) not implemented - needs settings page UI
- P-5 (edit/delete custom personas) not implemented - needs settings page UI
- P-6 (set default persona for new conversations) - settings already has defaultPersonaId field, just needs UI
- DATA-1 (persona interface stored correctly) - only custom personas need storage, built-in are in code
- UI-2 (persona selector compact/unobtrusive) - implemented but may need styling review
- CH-6 (retentionDays cleanup) still not implemented

---

2026-01-29 - P-6: Set default persona for new conversations

COMPLETED:
- Added default persona dropdown to settings page (settings/index.html)
- Populated dropdown with built-in personas (icon + name)
- Settings.ts saves defaultPersonaId to storage on save
- Dialog.tsx already uses settings.defaultPersonaId for new conversations
- Added i18n translations for all 10 languages (defaultPersona, defaultPersonaHint)

FILES CHANGED:
- src/settings/index.html (added defaultPersona select element)
- src/settings/settings.ts (import DEFAULT_PERSONAS, populate/save defaultPersonaId)
- src/shared/i18n/*.json (added settings.defaultPersona, settings.defaultPersonaHint)

PRD ITEMS COMPLETED:
- P-6: Set default persona for new conversations

NOTES FOR NEXT PERSON:
- P-2 (create custom persona in settings) not implemented - needs settings page UI
- P-5 (edit/delete custom personas) not implemented - needs settings page UI
- DATA-1 (persona interface stored correctly) - only custom personas need storage
- UI-2 (persona selector compact/unobtrusive) - may need styling review
- CH-6 (retentionDays cleanup) still not implemented

---

2026-01-29 - P-2: Create custom persona in settings

COMPLETED:
- Added Personas section to settings page with "Add Persona" button
- Persona form with name, description, icon picker (12 icons), system prompt fields
- Icon picker with visual selection (click to select)
- Save/Cancel buttons for form
- Persona list shows built-in (green bg) and custom personas
- Edit/Delete buttons on custom personas
- Delete confirmation dialog
- Custom personas stored in settings.customPersonas array
- Custom personas automatically added to default persona dropdown
- Handles deletion of persona that's currently set as default
- Added i18n translations for all 10 languages

FILES CHANGED:
- src/settings/index.html (added styles, persona section HTML)
- src/settings/settings.ts (persona management logic)
- src/shared/i18n/*.json (added persona management translations)

PRD ITEMS COMPLETED:
- P-2: Create custom persona in settings
- P-5: Edit and delete custom personas in settings
- DATA-1: Persona interface stored correctly

NOTES FOR NEXT PERSON:
- UI-2 (persona selector compact/unobtrusive) - may need styling review
- CH-6 (retentionDays cleanup) still not implemented

---

2026-01-29 - CH-6: Respect retentionDays setting for cleanup

COMPLETED:
- Added call to Storage.clearOldConversations() when dialog opens
- Uses retentionDays from settings (default 30 days)
- Cleanup runs on every dialog open (filters by updatedAt timestamp)
- Storage.clearOldConversations() method already existed, just needed to be called

FILES CHANGED:
- src/content/components/Dialog.tsx (added cleanup call in useEffect)

PRD ITEMS COMPLETED:
- CH-6: Respect retentionDays setting for cleanup

NOTES FOR NEXT PERSON:
- UI-2 (persona selector compact/unobtrusive) is the only remaining non-passing item
- All chat-history features (CH-1 through CH-7) now pass
- All persona features (P-1 through P-6) pass
- All data/integration tests (DATA-1, DATA-2, INT-1, INT-2) pass

---

2026-01-29 - UI-2: Persona selector compact and unobtrusive

COMPLETED:
- Made trigger button more compact (smaller padding, transparent bg until hover)
- Reduced font sizes and spacing throughout selector
- Made name truncation tighter (80px max)
- Added visual grouping for custom personas (subtle background wrapper)
- Reduced dropdown dimensions for cleaner appearance
- All changes maintain forest theme consistency

FILES CHANGED:
- src/content/components/PersonaSelector.tsx (styling updates)
- plans/prd.json (marked UI-2 as passing)

PRD ITEMS COMPLETED:
- UI-2: Persona selector compact and unobtrusive

NOTES FOR NEXT PERSON:
- ALL PRD ITEMS NOW PASS
- All chat-history features (CH-1 through CH-7) pass
- All persona features (P-1 through P-6) pass
- All UI features (UI-1 through UI-3) pass
- All data/integration tests (DATA-1, DATA-2, INT-1, INT-2) pass

---

2026-01-29 - HP-1: History page accessible from dialog

COMPLETED:
- Created dedicated history page (src/history/index.html + history.ts)
- History page shows conversations grouped by date (Today, Yesterday, This Week, This Month, Older)
- Each conversation displays: title, date/time, message count, persona icon
- Click conversation header or View button to expand/collapse messages
- Delete button with confirmation dialog
- Forest theme styling consistent with extension
- Dialog history icon now opens history.html in new tab (via background service worker)
- Added openHistory message type to BackgroundMessage
- Updated vite.config.ts to build history page
- Updated manifests to include history.html in web_accessible_resources
- Added i18n translations for all 10 languages (new history keys: today, thisWeek, thisMonth, older, deleteConfirm, view, close)
- Added unit tests for history page functionality

FILES CHANGED:
- src/history/index.html (new)
- src/history/history.ts (new)
- src/content/components/Dialog.tsx (handleOpenHistory now sends openHistory message)
- src/background/service-worker.ts (handles openHistory message)
- src/shared/types.ts (added openHistory to BackgroundMessage)
- vite.config.ts (added history entry point, copy history.html)
- manifest.firefox.json (added history.html to web_accessible_resources)
- manifest.chrome.json (added history.html to web_accessible_resources)
- src/shared/i18n/*.json (added history.today, history.thisWeek, etc. to all 10 languages)
- src/__tests__/history/history-page.test.ts (new)
- plans/prd.json (marked HP-1 as passing)

PRD ITEMS COMPLETED:
- HP-1: History page accessible from dialog

NOTES FOR NEXT PERSON:
- HP-2 through HP-10 now pass
- HP-11 (context toggle) not implemented - history page doesn't have context toggle
- HP-12 (remove history panel from dialog) - panel still exists but no longer opens
- PP-1 through PP-9 (personas page) not started
- UI-4, UI-5 (dialog UI tweaks) not started
- ICON-1 through ICON-6 (glyphs.fyi icons) not started

---

2026-01-29 - HP-5/HP-6: Continue conversation from history page

COMPLETED:
- Added "Continue" button to each history item
- Input area appears when Continue is clicked (expands + shows input)
- Input area mimics dialog InputArea: auto-expand textarea, send/clear buttons
- Streaming responses displayed in real-time
- Messages saved to conversation in storage after completion
- Persona system prompt applied when sending messages
- Esc key cancels streaming
- Added i18n translations for "continue" in all 10 languages
- Added unit tests for continue functionality

FILES CHANGED:
- src/history/index.html (added CSS for input area, streaming, continue button)
- src/history/history.ts (added continue/send/stream handlers)
- src/shared/i18n/*.json (added history.continue to all 10 languages)
- src/__tests__/history/history-page.test.ts (added continue tests)
- plans/prd.json (marked HP-2 through HP-10 as passing)

PRD ITEMS COMPLETED:
- HP-2: History grouped by date categories
- HP-3: History item shows title and metadata
- HP-4: View history item expands conversation
- HP-5: Continue conversation from history
- HP-6: Input area functional when continuing
- HP-7: Delete history item
- HP-8: Empty state when no history
- HP-9: History page styling matches forest theme
- HP-10: Persona restored when continuing conversation

NOTES FOR NEXT PERSON:
- HP-11 (context toggle) not implemented - would need to add to history page
- HP-12 (remove history panel from dialog) - inline panel still renders but doesn't open
- PP-1 through PP-9 (personas page) not started
- UI-4, UI-5 (dialog UI tweaks) not started
- ICON-1 through ICON-6 (glyphs.fyi icons) not started

---

2026-01-29 - HP-12: Remove history panel from dialog

COMPLETED:
- Removed HistoryPanel component import from Dialog.tsx
- Removed isHistoryOpen and savedConversations state variables
- Removed handleSelectConversation and handleDeleteConversation functions
- Removed HistoryPanel JSX from dialog render
- Deleted HistoryPanel.tsx component file (no longer needed)
- History icon (ðŸ“œ) now opens dedicated history page instead of inline panel
- Added tests to verify HistoryPanel.tsx is removed

FILES CHANGED:
- src/content/components/Dialog.tsx (removed HistoryPanel usage)
- src/content/components/HistoryPanel.tsx (deleted)
- src/__tests__/history/history-page.test.ts (added HP-12 tests)
- plans/prd.json (marked HP-12 as passing)

PRD ITEMS COMPLETED:
- HP-12: Remove history panel from dialog

NOTES FOR NEXT PERSON:
- HP-11 (context toggle in history) not implemented
- PP-1 through PP-9 (personas page) not started
- UI-4, UI-5 (dialog UI tweaks) not started
- ICON-1 through ICON-6 (glyphs.fyi icons) not started

---

2026-01-29 - PP-1 through PP-9: Dedicated Personas Page

COMPLETED:
- Created dedicated personas page (src/personas/index.html + personas.ts)
- Settings page has "Manage Personas" link that opens personas.html
- Page lists built-in personas (General, Code Helper, Writer, Researcher, Translator)
- Page lists custom personas with edit/delete buttons
- Add Persona modal with name, description, icon picker, system prompt
- Edit existing custom personas
- Delete custom personas with confirmation dialog
- Set default persona from personas page (shows "Default" badge)
- Built-in personas have no edit/delete buttons (read-only)
- Back button returns to settings page
- Forest theme styling consistent with extension
- Added i18n translations for all 10 languages
- Added unit tests for all persona page functionality
- Updated vite.config.ts to build personas page
- Updated manifests to include personas.html in web_accessible_resources

FILES CHANGED:
- src/personas/index.html (new)
- src/personas/personas.ts (new)
- src/settings/index.html (added Manage Personas link)
- src/settings/settings.ts (added link handler)
- vite.config.ts (added personas entry point)
- manifest.firefox.json (added personas.html)
- manifest.chrome.json (added personas.html)
- src/shared/i18n/*.json (added personas section to all 10 languages)
- src/__tests__/personas/personas-page.test.ts (new)
- plans/prd.json (marked PP-1 through PP-9 as passing)

PRD ITEMS COMPLETED:
- PP-1: Dedicated personas page accessible from settings
- PP-2: Personas page lists all personas
- PP-3: Create new persona from personas page
- PP-4: Edit custom persona from personas page
- PP-5: Delete custom persona from personas page
- PP-6: Built-in personas not editable or deletable
- PP-7: Set default persona from personas page
- PP-8: Personas page styling matches forest theme
- PP-9: Back navigation to settings

NOTES FOR NEXT PERSON:
- HP-11 (context toggle in history) not implemented
- UI-4, UI-5 (dialog UI tweaks) not started
- ICON-1 through ICON-6 (glyphs.fyi icons) not started

---

2026-01-29 - UI-5: Token counter removed from footer

COMPLETED:
- Removed tokenCount prop from InputArea component
- Removed token count display from dialog footer
- Removed estimateTokens function from Dialog.tsx (not needed anymore)
- Removed getCurrentTokenCount function from Dialog.tsx
- Removed unused tokenCountStyles and rightGroupStyles CSS
- Updated tests to verify token count is NOT displayed

FILES CHANGED:
- src/content/components/InputArea.tsx (removed tokenCount prop, display, and styles)
- src/content/components/Dialog.tsx (removed tokenCount prop usage and token estimation)
- src/__tests__/components/InputArea.test.tsx (removed token count test, added UI-5 verification)
- src/__tests__/components/Dialog.test.tsx (updated token count test to verify removal)
- plans/prd.json (marked UI-5 as passing)

PRD ITEMS COMPLETED:
- UI-5: Token counter removed from footer

NOTES FOR NEXT PERSON:
- HP-11 (context toggle in history) not implemented
- UI-4 (persona selector at bottom of dialog) not started
- ICON-1 through ICON-6 (glyphs.fyi icons) not started
